#!/usr/bin/env node

var Fs = require('fs');
var Path = require('path');
var Commander = require('commander-b');
var Moment = require('moment');

var program = Commander('bbn').version(require('../package.json').version);
program.command('new', 'create a new post').action(function() {
  var options = {};
  var configFile = Path.join(process.env.HOME, '.bbn.json');
  if (Fs.existsSync(configFile)) {
    options = require(configFile);
  }

  var m = Moment();
  var now = m.format();
  var today = m.format('YYYY-MM-DD');
  var template = [
    '---',
    'layout: post',
    'pubdate: "' + now + '"',
    'title: ',
    'tags: []',
    'minutes: ',
    'pagetype: posts',
    '---',
    ''
  ].join('\n');
  var directory = options.directory || '/home/bouzuya/blog.bouzuya.net';
  var file = today + '-diary.markdown';
  var path = Path.join(directory, 'src/_posts', file);
  Fs.writeFileSync(path, template, { encoding: 'utf8' });
  console.log('create a new post ' + file);
});
program.execute();
