(function(){var e,n,t,r,o,a,u,i,c,s;n=require("fs-extra"),s=require("path"),e=require("commander-b"),c=require("moment"),t=function(){var t;return t=e("bbn"),t.version(require("../package.json").version),t.command("new","create a new post").option("-d, --date <date>").option("-w, --weekend").action(function(e){var t,u,i,s,l;return null==e&&(e={}),t=r(),e.directory=t.directory||"/home/bouzuya/blog.bouzuya.net",l=e.date?e.date+"T23:59:59+09:00":null,i=c.apply(null,null!=l?[l,"YYYY-MM-DDThh:mm:ssZ"]:[]),s=o(e.directory,i.format("YYYY-MM-DD")),n.existsSync(s)?(console.error("the post "+s+" already exists"),1):(u=a(i,e),n.outputFileSync(s,u,{encoding:"utf8"}),console.log("create a new post "+s),0)}),t},r=function(){var e;return e=s.join(process.env.HOME,".bbn.json"),n.existsSync(e)?require(e):{}},o=function(e,n){var t,r,o,a;return o=n.split("-"),a=o[0],r=o[1],t=o[2],s.join(e,"data",a,r,n+"-diary.md")},a=function(e,n){return'---\nlayout: post\npubdate: "'+e.format()+"\"\ntitle: ''\ntags: ['']\nminutes:\npagetype: posts\n---\n\n"+(n.weekend?u(e,n):"")},u=function(e,n){var t;return t=[1,2,3,4,5,6,7].map(function(n){return c(e).subtract(n,"days").format("YYYY-MM-DD")}).map(function(e){return{date:e,title:i(n.directory,e),url:"http://blog.bouzuya.net/"+e.replace(/-/g,"/")+"/"}}),"# 今週のふりかえり\n\n"+t.map(function(e){return"- ["+e.date+" "+e.title+"]["+e.date+"]"}).join("\n")},i=function(e,t){var r,a;return r=n.readFileSync(o(e,t),{encoding:"utf8"}),a=r.match(/^title: '?(.*)$/m)[1],"'"===a[a.length-1]?a.slice(0,-1):a},module.exports=function(){var e;return e=t(),e.execute()}}).call(this);