(function(){var n,e,t,r,o,a,u,i,c,l;e=require("fs-extra"),l=require("path"),n=require("commander-b"),c=require("moment"),t=function(){var t;return t=n("bbn"),t.version(require("../package.json").version),t.command("new","create a new post").option("-d, --date <date>").option("-w, --weekend").action(function(n){var t,u,i,l,s;return null==n&&(n={}),t=r(),n.directory=t.directory||"/home/bouzuya/blog.bouzuya.net",s=n.date?n.date+"T23:59:59+09:00":null,i=c.apply(null,null!=s?[s,"YYYY-MM-DDThh:mm:ssZ"]:[]),l=o(n.directory,i.format("YYYY-MM-DD")),e.existsSync(l)?(console.error("the post "+l+" already exists"),1):(u=a(i,n),console.log(l),console.log(u),e.outputFileSync(l,u,{encoding:"utf8"}),console.log("create a new post "+l),0)}),t},r=function(){var n;return n=l.join(process.env.HOME,".bbn.json"),e.existsSync(n)?require(n):{}},o=function(n,e){var t,r,o,a;return o=e.split("-"),a=o[0],r=o[1],t=o[2],l.join(n,"data",a,r,e+"-diary.md")},a=function(n,e){return'---\nlayout: post\npubdate: "'+n.format()+"\"\ntitle: ''\ntags: ['']\nminutes:\npagetype: posts\n---\n\n"+(e.weekend?u(n,e):"")},u=function(n,e){var t;return t=[1,2,3,4,5,6,7].map(function(e){return c(n).subtract(e,"days").format("YYYY-MM-DD")}).map(function(n){return{date:n,title:i(e.directory,n),url:"http://blog.bouzuya.net/"+n.replace(/-/g,"/")+"/"}}),t.map(function(n){return"- ["+n.date+" "+n.title+"]["+n.date+"]"}).join("\n")+"\n\n"+t.map(function(n){return"["+n.date+"]: "+n.url}).join("\n")},i=function(n,t){var r,a;return r=e.readFileSync(o(n,t),{encoding:"utf8"}),a=r.match(/^title: '?(.*)$/m)[1],"'"===a[a.length-1]?a.slice(0,-1):a},module.exports=function(){var n;return n=t(),n.execute()}}).call(this);